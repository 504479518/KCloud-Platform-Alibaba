---
title: 项目启动【dev环境】
date: 2023-09-26 12:20:19
permalink: /pages/10bfa7/
---

你好呀，我的老朋友！我是老寇，欢迎来到老寇云平台！

## 环境搭建

修改win系统上面的hosts(如有需要，请自行更换IP)【目录位置：C:\Windows\System32\drivers\etc\hosts】



```shell
127.0.0.1 rocketmq-namesrv
127.0.0.1 redis
127.0.0.1 postgresql
127.0.0.1 nginx
127.0.0.1 elasticsearch
127.0.0.1 nacos
127.0.0.1 kafka
127.0.0.1 sentinel
127.0.0.1 gateway
127.0.0.1 tdengine
127.0.0.1 job
127.0.0.1 auth
127.0.0.1 admin
127.0.0.1 jaeger-collector
127.0.0.1 otel-collector
127.0.0.1 ui
127.0.0.1 arthas-server
127.0.0.1 seata
127.0.0.1 loki
127.0.0.1 react
```

```shell
services:
  postgresql:
    image: timescale/timescaledb:latest-pg17
    container_name: postgresql
    # 保持容器在没有守护程序的情况下运行
    tty: true
    restart: always
    privileged: true
    ports:
      - "5432:5432"
    volumes:
      - ./postgresql17/data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=root
      - POSTGRES_PASSWORD=laokou123
      - TZ=Asia/Shanghai
    networks:
      - laokou_network
  redis:
    image: redis:7.4.2
    container_name: redis
    # 保持容器在没有守护程序的情况下运行
    tty: true
    restart: always
    privileged: true
    ports:
      - "6379:6379"
    volumes:
      - ./redis7/conf/redis.conf:/etc/redis/redis.conf
      - ./redis7/data:/data
    command: redis-server --appendonly yes --requirepass 'laokou123'
    environment:
      - TZ=Asia/Shanghai
    networks:
      - laokou_network
  rocketmq-namesrv:
    image: apache/rocketmq:5.3.1
    container_name: rocketmq-namesrv
    # 保持容器在没有守护程序的情况下运行
    tty: true
    restart: always
    privileged: true
    ports:
      - "9876:9876"
    command: sh mqnamesrv
    environment:
      - JAVA_OPT_EXT=-server -Xmx512m -Xms512m -Xmn256m
      - TZ=Asia/Shanghai
    networks:
      - laokou_network
  rocketmq-broker:
    image: apache/rocketmq:5.3.1
    container_name: rocketmq-broker
    # 保持容器在没有守护程序的情况下运行
    tty: true
    restart: always
    privileged: true
    ports:
      - "10909:10909"
      - "10911:10911"
      - "10912:10912"
    # 自动创建主题
    command: sh mqbroker -n rocketmq-namesrv:9876 -c /home/rocketmq/conf/broker.conf autoCreateTopicEnable=true
    environment:
      - JAVA_OPT_EXT=-server -Xmx512m -Xms512m -Xmn256m
      - TZ=Asia/Shanghai
    volumes:
      - ./rocketmq5/broker/conf/broker.conf:/home/rocketmq/conf/broker.conf
      # 挂载数据
      - ./rocketmq5/broker/store:/home/rocketmq/store
      # 挂载日志
      - ./rocketmq5/broker/logs:/home/rocketmq/logs
    networks:
      - laokou_network
    depends_on:
      - rocketmq-namesrv
networks:
  laokou_network:
    driver: bridge
```

## 视频地址

[老寇云平台-项目演示视频](https://www.bilibili.com/video/BV16M411C7v7)

## 项目运行（请一定按照作者的步骤来）

🚀 注意：之前创建的数据库统统删掉（与该项目相关的数据库）

🚀 软件版本
<table>
    <tr>
        <th>软件名称</th>
        <th>软件版本</th>
    </tr>
    <tr>
        <td>JDK</td>
        <td>21</td>
    </tr>
    <tr>
        <td>Maven</td>
        <td>3.9.4</td>
    </tr>
    <tr>
        <td>TimescaleDB</td>
        <td>17</td>
    </tr>
    <tr>
        <td>Redis</td>
        <td>7.2.0+</td>
    </tr>
    <tr>
        <td>RocketMQ</td>
        <td>5.3.0+</td>
    </tr>
</table>

🚀 修改win系统上面的hosts(如有需要，请自行更换IP)

```shell
127.0.0.1 react
127.0.0.1 tdengine
127.0.0.1 emqx
127.0.0.1 rocketmq-namesrv
127.0.0.1 redis
127.0.0.1 elasticsearch
127.0.0.1 postgresql
127.0.0.1 nginx
127.0.0.1 register
127.0.0.1 kafka
127.0.0.1 job
127.0.0.1 sentinel
127.0.0.1 gateway
127.0.0.1 nacos
127.0.0.1 auth
127.0.0.1 admin
127.0.0.1 jaeger-collector
```

<font color="red">账号</font>

| 用户名    | 密码       | 租户    | 超级管理员 |
|--------|----------|-------|-------|
| admin  | admin123 | 老寇云集团 | 是     |
| test   | test123  | 老寇云集团 | 否     |
| laok5  | test123  | 老寇云集团 | 否     |
| wumh5  | test123  | 老寇云集团 | 否     |
| koush5 | test123  | 老寇云集团 | 否     |

🚀 项目拉取（安装git）

ssh方式拉取（推荐）

```shell
git clone git@github.com:KouShenhai/KCloud-Platform-IoT.git
```

https方式

```shell
git clone https://github.com/KouShenhai/KCloud-Platform-IoT.git
```

🚀 项目打包，确保项目能正常编译(先在test环境能正常打包，生产环境需要prod，默认使用maven插件跳过测试用例)

<font color="red">注意：项目根目录下执行（推荐test环境，dev是http，test是https，prod是https+kafka分布式链路）</font>

```shell
mvn clean install -P test
```

🚀 启动Postgresql、Redis、RocketMQ和Elasticsearch

🚀 初始化数据库
<img src="/img/5/img_21.png"/>

🚀 修改pom.xml配置，修改数据库连接信息，其他信息默认即可
<img src="/img/5/img_23.png"/>

🚀 必须运行laokou-nacos，启动单机Nacos（需要配置VM Option）
<img src="/img/5/img_5.png"/>

<font color="red">nacos开启grpc tls认证，需要增加如下参数</font>

```shell
-Xmx256m
-Xms256m
-Dnacos.standalone=true
-Dnacos.home=./logs
-Dnacos.remote.server.rpc.tls.enableTls=true
-Dnacos.remote.server.rpc.tls.mutualAuthEnable=true
-Dnacos.remote.server.rpc.tls.compatibility=false
-Dnacos.remote.server.rpc.tls.certChainFile=nacos-server-cert.pem
-Dnacos.remote.server.rpc.tls.certPrivateKey=nacos-server-key.pem
-Dnacos.remote.server.rpc.tls.trustCollectionCertFile=nacos-ca-cert.pem
-Dnacos.remote.server.rpc.tls.certPrivateKeyPassword=laokou123
--add-opens=java.base/java.lang=ALL-UNNAMED
```

<img src="/img/5/img_6.png"/>

🚀 打开Nacos控制台，创建命名空间（如有需要自行修改即可）
<img src="/img/5/img_7.png"/>

🚀 提醒：每个注册nacos的服务都需要在vm option增加参数【开启nacos grpc tls认证，需要增加如下参数】

```shell
-Xms512m
-Xmx512m
-Dlog4j.skipJansi=false
-Dnacos.remote.client.rpc.tls.enable=true
-Dnacos.remote.client.rpc.tls.mutualAuth=true
-Dnacos.remote.client.rpc.tls.certChainFile=nacos-client-cert.pem
-Dnacos.remote.client.rpc.tls.certPrivateKey=nacos-client-key.pem
-Dnacos.remote.client.rpc.tls.trustCollectionChainPath=nacos-ca-cert.pem
-Dnacos.remote.client.rpc.tls.certPrivateKeyPassword=laokou123
-Dserver.port=指定端口
# 注意：集成sentinel，还需要指定通讯端口，8722往后累计即可，端口不能重复，且不能和其他服务有冲突
-Dcsp.sentinel.api.port=指定端口
```

<img src="/img/5/img_30.png"/>

🚀 依次运行laokou-snail-job、 laokou-gateway、laokou-admin、laokou-auth（必须运行）

🚀 运行完laokou-gateawy 需要运行路由同步脚本
<img src="/img/5/img_2.png"/>
<img src="/img/5/img_28.png"/>

🚀 按需要运行laokou-monitor（不使用服务监控可以不启动），还有就是别用老夫的邮箱，求求你们改一改吧
<img src="/img/5/img_25.png"/>

🚀 按需要运行laokou-sentinel（不使用流量监控可以不启动）
<img src="/img/5/img_26.png"/>

## 常见问题

### 1.vue开启websocket，wss协议无法建立连接

解决方案见 [自签名证书安装浏览器](/pages/10bfa8/#创建证书-带域名)

### 2.阿里仓库无法下载最新jar

修改 maven/conf/setting.xml 配置

```xml

<mirrors>
	<mirror>
		<id>alimaven</id>
		<mirrorOf>central</mirrorOf>
		<name>aliyun maven</name>
		<url>https://maven.aliyun.com/nexus/content/repositories/central/</url>
	</mirror>
</mirrors>
```

### 3.如何生成服务端和客户端证书

解决方案见 [服务端和客户端证书](/pages/10bfa8/#服务端和客户端证书)

我是老寇，我们下次再见啦！
