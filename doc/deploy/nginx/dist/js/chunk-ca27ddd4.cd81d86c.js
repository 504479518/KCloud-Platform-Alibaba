(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ca27ddd4","chunk-8a47f206"],{"5bd3":function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var a=r("b775");function s(){return Object(a["b"])({url:"/admin/v1/tokens",method:"get"})}},"765c":function(e,t,r){"use strict";r.d(t,"k",(function(){return s})),r.d(t,"h",(function(){return n})),r.d(t,"i",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return u})),r.d(t,"l",(function(){return c})),r.d(t,"o",(function(){return d})),r.d(t,"c",(function(){return m})),r.d(t,"q",(function(){return l})),r.d(t,"e",(function(){return f})),r.d(t,"m",(function(){return h})),r.d(t,"f",(function(){return p})),r.d(t,"d",(function(){return b}));var a=r("b775");function s(e){return Object(a["b"])({url:"/admin/v1/resource/list",method:"post",data:e})}function n(e){return Object(a["b"])({url:"/admin/v1/resource/"+e,method:"get"})}function o(e){return Object(a["b"])({url:"/admin/v1/resource/"+e+"/detail-task",method:"get"})}function i(e,t){return Object(a["b"])({url:"/admin/v1/resource/audit-task",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8","request-id":t}})}function u(e){return Object(a["b"])({url:"/admin/sys/resource/image/api/insert",method:"post",data:e})}function c(e){return Object(a["b"])({url:"/admin/v1/resource/task-list",method:"post",data:e})}function d(e){return Object(a["b"])({url:"/admin/v1/resource",method:"put",data:e})}function m(e){return Object(a["b"])({url:"/admin/sys/resource/image/api/delete?id="+e,method:"delete"})}function l(e){return Object(a["b"])({url:"/admin/v1/resource/upload",method:"post",data:e})}function f(e){return Object(a["b"])({url:"/admin/sys/resource/image/api/auditLog?businessId="+e,method:"get"})}function h(){return Object(a["b"])({url:"/admin/sys/resource/image/api/syncIndex",method:"post"})}function p(e){return Object(a["b"])({url:"/admin/sys/resource/image/api/diagram?processInstanceId="+e,method:"get"})}function b(e){return Object(a["b"])({url:"/admin/sys/resource/image/api/download?id="+e,method:"get",responseType:"blob"})}},8510:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("page-header-wrapper",[r("a-card",{attrs:{bordered:!1}},[r("div",{staticClass:"table-page-search-wrapper"},[r("a-form",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["resource:task-list"],expression:"['resource:task-list']"}],attrs:{layout:"inline"}},[r("a-row",{attrs:{gutter:48}},[r("a-col",{attrs:{md:8,sm:24}},[r("a-form-item",{attrs:{label:"流程名称"}},[r("a-input",{attrs:{placeholder:"请输入","allow-clear":""},model:{value:e.queryParam.name,callback:function(t){e.$set(e.queryParam,"name",t)},expression:"queryParam.name"}})],1)],1),r("a-col",{attrs:{md:8,sm:24}},[r("span",{staticClass:"table-page-search-submitButtons"},[r("a-button",{attrs:{type:"primary"},on:{click:e.handleQuery}},[r("a-icon",{attrs:{type:"search"}}),e._v("查询")],1),r("a-button",{staticStyle:{"margin-left":"8px"},on:{click:e.resetQuery}},[r("a-icon",{attrs:{type:"redo"}}),e._v("重置")],1)],1)])],1)],1)],1),r("create-form",{ref:"createForm",on:{ok:e.getList}}),r("a-modal",{attrs:{title:e.title,visible:e.open,"confirm-loading":e.submitLoading},on:{ok:e.submitForm,cancel:e.cancel}},[r("a-form-model",{ref:"form",attrs:{model:e.form,rules:e.rules}},[r("a-form-model-item",{attrs:{label:"选择用户",prop:"assignee"}},[r("a-select",{attrs:{placeholder:"请选择"},model:{value:e.form.assignee,callback:function(t){e.$set(e.form,"assignee",t)},expression:"form.assignee"}},e._l(e.userList,(function(t,a){return r("a-select-option",{key:a,attrs:{value:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1)],1)],1)],1),r("a-table",{attrs:{loading:e.loading,size:e.tableSize,rowKey:"taskId",columns:e.columns,"data-source":e.list,pagination:!1,bordered:e.tableBordered},scopedSlots:e._u([{key:"operation",fn:function(t,a){return r("span",{},[r("a",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["resource:audit-task"],expression:"['resource:audit-task']"}],on:{click:function(t){return e.$refs.createForm.handleAudit(a)}}},[r("a-icon",{attrs:{type:"audit"}}),e._v(" 审批 ")],1),r("a-divider",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["resource:resolve-task"],expression:"['resource:resolve-task']"}],attrs:{type:"vertical"}}),r("a",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["resource:resolve-task"],expression:"['resource:resolve-task']"}],on:{click:function(t){return e.resolveProcess(a)}}},[r("a-icon",{attrs:{type:"user-delete"}}),e._v(" 处理 ")],1),r("a-divider",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["resource:transfer-task"],expression:"['resource:transfer-task']"}],attrs:{type:"vertical"}}),r("a",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["resource:transfer-task"],expression:"['resource:transfer-task']"}],on:{click:function(t){return e.handleProcess(a,0)}}},[r("a-icon",{attrs:{type:"user"}}),e._v(" 转办 ")],1),r("a-divider",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["resource:delegate-task"],expression:"['resource:delegate-task']"}],attrs:{type:"vertical"}}),r("a",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["resource:delegate-task"],expression:"['resource:delegate-task']"}],on:{click:function(t){return e.handleProcess(a,1)}}},[r("a-icon",{attrs:{type:"user-add"}}),e._v(" 委派 ")],1)],1)}}])}),r("a-pagination",{staticClass:"ant-table-pagination",attrs:{"show-size-changer":"","show-quick-jumper":"",current:e.queryParam.pageNum,total:e.total,"page-size":e.queryParam.pageSize,showTotal:function(){return"共 "+e.total+" 条"}},on:{showSizeChange:e.onShowSizeChange,change:e.changeSize}})],1)],1)},s=[],n=(r("d3b7"),r("4de4"),r("765c")),o=r("b775");function i(e){return Object(o["b"])({url:"/admin/workflow/task/api/resource/transfer",method:"post",data:e})}function u(e){return Object(o["b"])({url:"/admin/workflow/task/api/resource/delegate",method:"post",data:e})}function c(e){return Object(o["b"])({url:"/admin/workflow/task/api/resource/resolve",method:"post",data:e})}var d=r("d5bd"),m=r("435a"),l=r("9fb0"),f=r("e717"),h=r("8ded"),p=r.n(h),b={name:"Task",components:{CreateForm:f["default"]},mixins:[m["a"]],data:function(){return{list:[],loading:!1,total:0,userList:[],title:"",open:!1,form:{userId:"",assignee:"",taskId:"",instanceId:"",businessKey:"",instanceName:""},type:0,submitLoading:!1,queryParam:{pageNum:1,pageSize:10,name:""},columns:[{title:"任务编号",dataIndex:"taskId",align:"center",ellipsis:!0},{title:"流程名称",dataIndex:"name",align:"center",ellipsis:!0},{title:"任务名称",dataIndex:"taskName",align:"center",ellipsis:!0},{title:"实例名称",dataIndex:"instanceName",align:"center",ellipsis:!0},{title:"任务执行人",dataIndex:"username",align:"center",ellipsis:!0},{title:"创建时间",dataIndex:"createDate",align:"center",width:"14%"},{title:"操作",width:"25%",dataIndex:"operation",scopedSlots:{customRender:"operation"},align:"center"}],rules:{assignee:[{required:!0,message:"请选择用户",trigger:"blur"}]}}},filters:{},created:function(){this.getList(),this.getUserList()},computed:{},watch:{},methods:{resolveProcess:function(e){var t=this;this.loading=!0,this.reset(),this.form.businessKey=e.businessKey,this.form.instanceId=e.processInstanceId,this.form.instanceName=e.processInstanceName,this.form.taskId=e.taskId,c(this.form).then((function(){t.$message.success("处理成功",3),t.getList()})).finally((function(){t.loading=!1}))},getList:function(){var e=this;this.loading=!0,Object(n["l"])(this.queryParam).then((function(t){e.list=t.data.records,e.total=t.data.total-0,e.loading=!1}))},getUserList:function(){var e=this;Object(d["e"])().then((function(t){var r=p.a.get(l["s"]);e.form.userId=r,e.userList=t.data.filter((function(e){return e.value!==r}))}))},submitForm:function(){var e=this;this.$refs.form.validate((function(t){if(!t)return!1;var r=e.type;e.submitLoading=!0,0===r?i(e.form).then((function(){e.$message.success("转办成功",3),e.getList()})):u(e.form).then((function(){e.$message.success("委派成功",3),e.getList()})),e.open=!1,e.submitLoading=!1}))},handleProcess:function(e,t){this.reset(),this.type=t,this.form.businessKey=e.businessKey,this.form.instanceId=e.processInstanceId,this.form.instanceName=e.processInstanceName,this.form.taskId=e.taskId,this.title=0===t?"转办":"委派",this.open=!0},cancel:function(){this.open=!1},reset:function(){this.form={userId:this.form.userId,assignee:"",taskId:"",instanceId:"",businessKey:"",instanceName:""}},handleQuery:function(){this.queryParam.pageNum=1,this.getList()},resetQuery:function(){this.dateRange=[],this.queryParam={pageNum:1,pageSize:10,name:""},this.handleQuery()},onShowSizeChange:function(e,t){this.queryParam.pageSize=t,this.getList()},changeSize:function(e,t){this.queryParam.pageNum=e,this.queryParam.pageSize=t,this.getList()}}},v=b,g=r("2877"),k=Object(g["a"])(v,a,s,!1,null,null,null);t["default"]=k.exports},d5bd:function(e,t,r){"use strict";r.d(t,"d",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return o})),r.d(t,"h",(function(){return i})),r.d(t,"a",(function(){return u})),r.d(t,"f",(function(){return c})),r.d(t,"j",(function(){return d})),r.d(t,"i",(function(){return m})),r.d(t,"k",(function(){return l})),r.d(t,"e",(function(){return f})),r.d(t,"g",(function(){return h}));var a=r("b775");function s(e){return Object(a["b"])({url:"/admin/v1/users/list",method:"post",data:e})}function n(e){return Object(a["b"])({url:"/admin/v1/users/"+e,method:"get"})}function o(e,t){return Object(a["b"])({url:"/admin/v1/users",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8","request-id":t}})}function i(e){return Object(a["b"])({url:"/admin/v1/users",method:"put",data:e})}function u(e){return Object(a["b"])({url:"/admin/v1/users/"+e,method:"delete"})}function c(e){return Object(a["b"])({url:"/admin/v1/users/reset-password",method:"put",data:e})}function d(e){return Object(a["b"])({url:"/admin/v1/users/status",data:e,method:"put"})}function m(e){return Object(a["b"])({url:"/admin/v1/users/profile",method:"put",data:e})}function l(e){return Object(a["b"])({url:"/admin/v1/oss/upload",method:"post",data:e})}function f(){return Object(a["b"])({url:"/admin/v1/users/option-list",method:"get"})}function h(e){return Object(a["b"])({url:"/admin/v1/users/password",data:e,method:"put"})}},e717:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("a-drawer",{attrs:{width:"35%","label-col":4,"wrapper-col":14,visible:e.open},on:{close:e.onClose}},[r("a-divider",{attrs:{orientation:"left"}},[r("b",[e._v(e._s(e.formTitle))])]),r("a-form-model",{ref:"form2"},[r("a-form-model-item",{attrs:{label:"编号",prop:"id"}},[e._v(" "+e._s(e.form2.id)+" ")]),r("a-form-model-item",{attrs:{label:"类型",prop:"code"}},[r("span",{directives:[{name:"show",rawName:"v-show",value:"image"===e.form2.code,expression:"form2.code === 'image'"}]},[e._v("图片")]),r("span",{directives:[{name:"show",rawName:"v-show",value:"video"===e.form2.code,expression:"form2.code === 'video'"}]},[e._v("视频")]),r("span",{directives:[{name:"show",rawName:"v-show",value:"audio"===e.form2.code,expression:"form2.code === 'audio'"}]},[e._v("音频")])]),r("a-form-model-item",{attrs:{label:"标题",prop:"title"}},[e._v(" "+e._s(e.form2.title)+" ")]),r("a-form-model-item",{attrs:{label:"备注",prop:"remark"}},[r("a-input",{attrs:{disabled:"disabled",type:"textarea","allow-clear":""},model:{value:e.form2.remark,callback:function(t){e.$set(e.form2,"remark",t)},expression:"form2.remark"}})],1),r("a-form-model-item",{attrs:{label:"资源",prop:"url"}},[r("audio",{directives:[{name:"show",rawName:"v-show",value:"audio"===e.form2.code,expression:"form2.code === 'audio'"}],attrs:{loop:"loop",src:e.form2.url,controls:"controls"}},[r("object",{attrs:{data:e.form2.url}},[r("embed",{attrs:{src:e.form2.url}})])]),r("img",{directives:[{name:"show",rawName:"v-show",value:"image"===e.form2.code,expression:"form2.code === 'image'"}],attrs:{src:e.form2.url,width:"100",height:"100",alt:"暂无图片"}}),r("video",{directives:[{name:"show",rawName:"v-show",value:"video"===e.form2.code,expression:"form2.code === 'video'"}],attrs:{src:e.form2.url,loop:"loop",width:"250",height:"100",controls:"controls"}},[r("source",{attrs:{src:e.form2.url,type:"video/mp4"}}),r("object",{attrs:{data:e.form2.url,width:"200",height:"100"}},[r("embed",{attrs:{src:e.form2.url,width:"200",height:"100"}})])])])],1),r("a-form-model",{ref:"form",attrs:{model:e.form,rules:e.rules}},[r("a-form-model-item",{attrs:{label:"审批意见",prop:"comment"}},[r("a-input",{attrs:{placeholder:"请输入审批意见",type:"textarea","allow-clear":""},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1),r("div",{staticClass:"bottom-control"},[r("a-space",[r("a-button",{attrs:{type:"primary",loading:e.submitLoading},on:{click:function(t){return e.submitForm("1")}}},[e._v(" 同意 ")]),r("a-button",{attrs:{type:"danger",loading:e.submitLoading},on:{click:function(t){return e.submitForm("0")}}},[e._v(" 驳回 ")])],1)],1)],1)],1)},s=[],n=(r("d3b7"),r("ddb0"),r("765c")),o=r("5bd3"),i={name:"TaskForm",props:{},components:{},data:function(){return{accessToken:"",submitLoading:!1,formTitle:"",form2:{id:"",code:"",title:"",url:"",remark:""},form:{comment:"",taskId:"",taskName:"",instanceId:"",businessKey:"",instanceName:"",values:{auditStatus:""}},open:!1,rules:{comment:[{required:!0,message:"审批意见不为空",trigger:"blur"}]}}},filters:{},created:function(){},computed:{},watch:{},methods:{token:function(){var e=this;Object(o["a"])().then((function(t){e.accessToken=t.data.token}))},onClose:function(){this.open=!1},cancel:function(){this.open=!1,this.reset()},getDetail:function(e){var t=this;Object(n["i"])(e).then((function(r){t.form2.title=r.data.title,t.form2.code=r.data.code,t.form2.id=r.data.id,t.form2.remark=r.data.remark,t.form2.url=r.data.url,t.form2.id=e}))},reset:function(){this.form2={id:"",code:"",title:"",url:"",remark:""},this.form={comment:"",taskId:"",taskName:"",instanceId:"",businessKey:"",instanceName:"",values:{auditStatus:""}}},handleAudit:function(e){this.form.taskId=e.taskId,this.form.instanceId=e.instanceId,this.form.taskName=e.taskName,this.form.businessKey=e.businessKey,this.form.instanceName=e.instanceName,this.getDetail(this.form.businessKey),this.token(),this.open=!0,this.formTitle="审批"},submitForm:function(e){var t=this;this.$refs.form.validate((function(r){if(!r)return!1;t.submitLoading=!0,t.form.values.auditStatus=e,Object(n["b"])(t.form,t.accessToken).then((function(){t.$message.success("审批成功",3),t.open=!1,t.$emit("ok"),t.reset()})).catch((function(){t.token()})).finally((function(){t.submitLoading=!1}))}))}}},u=i,c=r("2877"),d=Object(c["a"])(u,a,s,!1,null,null,null);t["default"]=d.exports}}]);